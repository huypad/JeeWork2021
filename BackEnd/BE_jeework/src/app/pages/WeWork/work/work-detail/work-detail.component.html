<form class="kt-form work-detail" style="width: 100%;">
    <div class="row" style="font-size: 10.5pt;">
        <kt-portlet [options]="{headLarge: true, hideHeader:true}" style="width: 100%;">
            <ng-container mPortletBody>
                <div class="kt-form__group" style="padding: 15px; line-height: 25px;">
                    <div class="row" style=" border-bottom: 1px solid rgba(0,0,0,0.15);">
                        <table style="width: 100%;">
                            <tr>
                                <h4 style="color: black;">
                                    {{item.title}}
                                </h4>
                            </tr>
                            <tr>
                                <div style="display: flex;">
                                    <span class="name-project url" *ngIf="item.project_team">
                                        {{item.project_team}}
                                    </span>
                                    <i style="font-size: 20px;
                                    padding: 2px 10px;" class="fas fa-long-arrow-alt-right"></i>
                                    <span class="name-project url" [matMenuTriggerFor]="menu">{{item.milestone}} <i
                                            style="font-size: 80%;
                                        padding-left: 10px;" class="fas fa-chevron-down"></i></span>
                                    <mat-menu #menu="matMenu">
                                        <kt-choose-milestone-and-tags [options]="listType"
                                            [project_team]="item.project_team" [id_project_Team]="item.id_project_team"
                                            [Id]="DataID" [Id_key]="0" [Loai]="'id_milestone'"
                                            (ItemSelected)="ReloadData($event)">
                                        </kt-choose-milestone-and-tags>
                                    </mat-menu>
                                </div>
                            </tr>
                            <tr>
                                <span style="font-size:10pt; color: #666;">
                                    <i class="far fa-clock"></i>
                                    {{'GeneralKey.ngaybatdau'|translate}}: <span popoverTitle="{{'GeneralKey.ngaybatdau'|translate}}" [popover]="PopoverTime"
                                        popoverPlacement="bottom" [popoverOnHover]="false"
                                        class="date">{{item.start_date}}</span> -> <span popoverTitle="Deadline"
                                        [popover]="PopoverDeadline" popoverPlacement="bottom" [popoverOnHover]="false"
                                        class="date">Thời hạn: {{item.deadline}}</span>
                                </span>
                            </tr>
                            <popover-content #PopoverDeadline placement="bottom-right">
                                <kt-choose-time [Id]="item.id_row" [Id_key]="17" [Loai]="'deadline'"></kt-choose-time>
                            </popover-content>
                            <popover-content #PopoverTime placement="bottom-right">
                                <kt-choose-time [Id]="item.id_row" [Id_key]="11" [Loai]="'start_date'"></kt-choose-time>
                            </popover-content>
                        </table>
                    </div>
                    <div class="row" style=" border-bottom: 1px solid rgba(0,0,0,0.15);">
                        <div class="thanhtrangthai">
                            <div class="filter">
                                <div class="url status w-100 h-100 {{item.status==2?'hoanthanh':'chuahoanthanh'}} "
                                    [matMenuTriggerFor]="status">
                                    <span *ngIf="item.status==1" translate="filter.choreview"></span>
                                    <span *ngIf="item.status==2" translate="filter.hoanthanh"></span>
                                    <span *ngIf="item.status==3" translate="filter.danglam"></span>
                                </div>
                                <mat-menu #status="matMenu">
                                    <button mat-menu-item (click)="Update_Status('1')">
                                        <span translate="filter.choreview"></span>
                                    </button>
                                    <button mat-menu-item (click)="Update_Status('2')">
                                        <span translate="filter.hoanthanh"></span>
                                    </button>
                                    <button mat-menu-item (click)="Update_Status('3')">
                                        <span translate="filter.danglam"></span>
                                    </button>
                                </mat-menu>
                            </div>
                            <div class="giaoviec">
                                <div class="choose-user" [matMenuTriggerFor]="adduser">
                                    <div *ngIf="item.assign;else chooseuser">
                                        <div class="user-selected">
                                            <div class="avatar">
                                                <div class="user url" style="width: 40px; height: 40px;">
                                                    <img style="width: 36px; height: 36px;" src={{item.assign.image}}>
                                                </div>
                                            </div>
                                            <div class="info-selected">
                                                <div class="url -hover" style="font-size: 13pt;">{{item.assign.hoten}}
                                                </div>
                                                <div> {{item.assign.tenchucdanh}} </div>
                                            </div>
                                        </div>
                                    </div>
                                    <ng-template #chooseuser>
                                        <div class="select-user">
                                            <i class="fa fa-plus"></i> {{ 'topic.assign' | translate}}
                                        </div>
                                    </ng-template>
                                    <div style="padding: 11px 0;">
                                        <i class="fas fa-sort"></i>
                                    </div>
                                </div>
                                <mat-menu #adduser="matMenu">
                                    <div class="page-work-detail">
                                        <kt-choose-users [options]="options_assign"
                                            (ItemSelected)="ItemSelected($event)" (IsSearch)="stopPropagation($event)">
                                        </kt-choose-users>
                                    </div>
                                </mat-menu>
                            </div>
                        </div>
                    </div>

                    <div class="row" style="padding-top: 20px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 50%;">
                                    <div class="title">
                                        <span translate="work.mieutacongviec"></span>
                                    </div>
                                </td>
                                <td style="width: 50%; text-align: end;">
                                    <a class="action" (click)="Update_MotaCongViec()">
                                        <span translate="GeneralKey.chinhsua"></span>
                                    </a>&nbsp;&nbsp;
                                    <a class="action" (click)="Update_CheckList()">
                                        <span translate="work.themchecklist"></span>
                                    </a>
                                </td>
                            </tr>
                            <tr *ngIf="!IsShow_MoTaCV">
                                <td colspan="2" style="width: 100%;">
                                    <span style="font-size:10pt; color: #666;" [innerHTML]="description"
                                        *ngIf="item.description">
                                    </span>
                                    <span style="font-size:10pt; color: #666;" *ngIf="!item.description">
                                        {{'GeneralKey.chuamotacongviec'|translate}}
                                    </span>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="row" *ngIf="IsShow_MoTaCV">
                        <table style="width: 100%;">
                            <tr>
                                <td colspan="2" style="width: 100%;">
                                    <div class="textcus">
                                        <mat-form-field class="mat-form-field-fluid">
                                            <input matInput placeholder="{{ 'work.motacongviec' | translate }}"
                                                [ngModelOptions]="{standalone: true}" [(ngModel)]="MoTaCongViec">
                                        </mat-form-field>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" style="width: 100%;">
                                    <button type="button"
                                        style="width: 100px;font-size: 12pt;padding: 5px;margin-right: 20px;"
                                        class="btn btn-primary" (click)="UpdateByKey('16', 'description', true)"
                                        matTooltip="{{ 'GeneralKey.luu' | translate }}">
                                        <span translate="GeneralKey.luu"></span>
                                    </button>
                                    <button type="button" style="font-size: 12pt;padding: 5px;" class="btn  text-danger"
                                        (click)="Update_MotaCongViec()" color="warn" cdkFocusInitial
                                        matTooltip="{{ 'GeneralKey.trolai' | translate }}">
                                        <mat-icon>close</mat-icon>
                                    </button>
                                </td>
                            </tr>
                        </table>

                    </div>
                    <div class="row align-items-center" style="padding-top: 20px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 70%;">
                                    <div class="title">
                                        <span translate="work.tailieudinhkem"></span>
                                    </div>
                                </td>
                                <td style="width: 30%; text-align: end;">
                                    <a class="action" (click)="csvInput.click()">
                                        <span translate="work.themtailieu"></span>
                                        <i matTooltip="{{ 'topic.upload' | translate }}" class="las la-upload"></i>&nbsp;
                                    </a>

                                    <input #csvInput hidden="true" type="file" onclick="this.value=null"
                                        (change)="save_file_Direct($event, '1')" />

                                </td>
                            </tr>
                            <tr>
                                <td style="width: 100%;" colspan="2" class="color-tieude">
                                    <div class="row comment-box"
                                        *ngIf="item.Attachments?item.Attachments.length>0:false">
                                        <div class="col-md-12 kt-margin-bottom-10-mobile"
                                            *ngFor="let att2 of item.Attachments;">
                                            <div class="attach-item show-action">
                                                <div class="attach-item-icon">
                                                    <img src="{{att2.icon}}" />
                                                </div>
                                                <div class="attach-item-name">
                                                    <p>{{att2.filename}}</p>
                                                </div>
                                                <div class="attach-item-del">

                                                    <a class="text-success" 
                                                        matTooltip="Preview">
                                                        <i class="far fa-eye"></i>
                                                    </a>

                                                    <a class=" text-primary" 
                                                        matTooltip="Download">
                                                        <i class="fas fa-download"></i>
                                                    </a>

                                                    <a class=" text-danger" 
                                                        matTooltip="Xóa File">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <span style="font-size:10pt; color: #111;" *ngIf="!item.Attachments">
                                {{'GeneralKey.khongcotailieudinhkem'|translate}}
                            </span>
                        </table>
                    </div>
                    <div class="row" *ngIf="IsShow_CheckList">

                        <div class="textcus w-100">
                            <mat-form-field class="mat-form-field-fluid">
                                <input matInput placeholder="{{ 'work.themchecklist' | translate }}"
                                    [ngModelOptions]="{standalone: true}" [(ngModel)]="checklist">
                            </mat-form-field>
                        </div>
                        <div>
                            <button type="button" style="width: 100px;font-size: 12pt;padding: 5px;margin-right: 20px;"
                                class="btn btn-primary" (click)="UpdateByKey('0', '', true)"
                                matTooltip="{{ 'GeneralKey.them' | translate }}">
                                <span translate="GeneralKey.them"></span>
                            </button>
                            <button type="button" style="font-size: 12pt;padding: 5px;" class="btn  text-danger"
                                (click)="Update_CheckList()" cdkFocusInitial
                                matTooltip="{{ 'GeneralKey.trolai' | translate }}">
                                <mat-icon>close</mat-icon>
                            </button>
                        </div>
                        
                    </div>
                    <div class=" check-list " style="padding-top: 20px;">
                        <div class="title">
                            <span translate="work.danhsachcankiemtra"></span>
                        </div>
                        <mat-accordion style="display: contents;" *ngFor="let item of CheckList">
                            <mat-expansion-panel style="width: 100%;margin-bottom: 10px;">
                                <mat-expansion-panel-header style="padding: 0 10px;">
                                    <mat-panel-title class="w-100">
                                        <div class="row w-100">
                                            <div class="col-md-8 kt--margin-bottom-10-mobile header-center">

                                                <span
                                                    style="color: black;font-size: 11pt;font-weight: 450;">{{item.title}}</span>&nbsp;&nbsp;
                                            </div>
                                            <div class=" col-md-4 kt--margin-bottom-10-mobile text-right">
                                                <a class="action" (click)="_UpdateCheckList(item)">
                                                    <span translate="GeneralKey.chinhsua"></span>
                                                </a>&nbsp;&nbsp;
                                                <a class="action" (click)="Delete_CheckList(item)">
                                                    <span translate="GeneralKey.xoa"></span>
                                                </a>
                                            </div>
                                        </div>
                                    </mat-panel-title>
                                </mat-expansion-panel-header>
                                <perfect-scrollbar class="kt-scrollable kt-scroller" style="padding-left: 25px; display: contents">
                                    <table class="table table-hover w-100">
                                        <thead>
                                            <tr>
                                                <mat-form-field class="mat-form-field-fluid">
                                                    <input style="font-size: 14px;" matInput
                                                        placeholder="{{ 'work.themchecklist' | translate }}"
                                                        [ngModelOptions]="{standalone: true}"
                                                        [(ngModel)]="checklist_item">

                                                        <a matSuffix class="action"
                                                        (click)="InsertCheckListItem(item.id_row)">
                                                        <span translate="GeneralKey.them"></span>
                                                    </a>
                                                    <button matSuffix type="button" style="margin-left:10px"
                                                        mat-icon-button (click)="Update_CheckList()" color="warn"
                                                        cdkFocusInitial matTooltip="{{ 'GeneralKey.trolai' | translate }}">
                                                        <mat-icon>close</mat-icon>
                                                    </button>
                                                </mat-form-field>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr *ngFor="let items of item.items">
                                                <div class="check-list-item">
                                                    <div class="check-list-item--title">
                                                        <span style="font-size: 14px;">{{items.title}}</span>
                                                    </div>
                                                    <div class="check-list-item--action">
                                                        <div class="action-active">
                                                            <span class="update" (click)="UpdateCheckList_Item(items)"
                                                                cdkFocusInitial
                                                                matTooltip="{{ 'GeneralKey.capnhat' | translate }}">
                                                                <mat-icon>create</mat-icon>
                                                            </span>
                                                            <span class="delete" (click)="DeleteItem(items)"
                                                                cdkFocusInitial
                                                                matTooltip="{{ 'GeneralKey.xoa' | translate }}">
                                                                <mat-icon>delete_outline</mat-icon>
                                                            </span>
                                                        </div>
                                                        <div class="choose-user-small action-user"
                                                            [matMenuTriggerFor]="userChecklist">
                                                            <ng-container *ngIf="items.checker;else userIsnull">
                                                                <img matTooltip={{items.checker.hoten}}
                                                                    style="width: 25px; height: 25px;"
                                                                    src="{{items.checker.image}}" alt="">
                                                            </ng-container>
                                                            <ng-template #userIsnull>
                                                                <i matTooltip="Assign todo in checklist"
                                                                    class="las la-plus"></i>
                                                            </ng-template>
                                                        </div>
                                                        <div class="action-time">
                                                            <span style="color: #111;">
                                                                {{items.CreatedDate }}
                                                            </span>
                                                        </div>

                                                        <mat-menu #userChecklist="matMenu">
                                                            <div class="page-work-detail">
                                                                <kt-choose-users [options]="options_assign"
                                                                    (IsSearch)="stopPropagation($event)">
                                                                </kt-choose-users>
                                                            </div>
                                                        </mat-menu>
                                                    </div>
                                                </div>
                                                
                                            </tr>
                                        </tbody>
                                    </table>
                                   
                                </perfect-scrollbar>
                            </mat-expansion-panel>
                        </mat-accordion>

                    </div>
                    <div class="row align-items-center" style="padding-top: 20px;">
                        <table style="width: 100%;">
                            <tr>
                                <td style="width: 50%;">
                                    <div class="title">
                                        <span translate="work.ketquacongviec"></span>
                                    </div>
                                </td>
                                
                            </tr>
                            <tr>
                                <td style="width: 100%;" colspan="2" class="color-tieude">
                                    <div class="row" *ngIf="IsShow_Result">
                                        <table style="width: 100%;">
                                            <tr>
                                                <td colspan="2" style="width: 100%">
                                                    <mat-form-field class="mat-form-field-fluid">
                                                        <textarea matInput
                                                            placeholder="{{ 'work.capnhatketquacongviec' | translate }}"
                                                            [(ngModel)]="Comment" [ngModelOptions]="{standalone: true}"
                                                            (keydown.enter)="CommentInsert($event.target.value,0,0,1)"
                                                            rows="3">
                                                    </textarea> </mat-form-field>
                                                </td>
                                            </tr>

                                        </table>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td style="width: 100%;" colspan="2" class="color-tieude">
                                    <div class="row comment-box" style="margin-bottom: 10px;"
                                        *ngIf="item.Attachments_Result?item.Attachments_Result.length>0:false">
                                        <div class="col-md-12 kt-margin-bottom-10-mobile"
                                            *ngFor="let att2 of item.Attachments_Result;">
                                            <div class="attach-item show-action">
                                                <div class="attach-item-icon">
                                                    <img src="{{att2.icon}}" />
                                                </div>
                                                <div class="attach-item-name">
                                                    <p>{{att2.filename}}</p>
                                                </div>
                                                <div class="attach-item-del">

                                                    <a class="text-success" 
                                                        matTooltip="Preview">
                                                        <i class="far fa-eye"></i>
                                                    </a>

                                                    <a class=" text-primary" 
                                                        matTooltip="Download">
                                                        <i class="fas fa-download"></i>
                                                    </a>

                                                    <a class=" text-danger" 
                                                        matTooltip="Xóa File">
                                                        <i class="fas fa-trash-alt"></i>
                                                    </a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>

                            <tr *ngIf="IsShow_Result">
                                <td colspan="2" style="width: 100%">
                                    <div *ngIf="Comment.length>0">
                                        <button mat-raised-button class="jee_btn-addcontinue"  (click)="CommentInsert(Comment,0,0,1)">
                                            <span translate="GeneralKey.luu"></span>
                                        </button>
                                        <button class="btn d-inline" (click)="Update_Result();Comment=''">
                                            <i class="las la-close"></i>
                                            <span translate="GeneralKey.cancel"> </span>
                                        </button>
                                        <br />
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2" style="width: 100%">
                                    <a class="action" (click)="Update_Result()">

                                        <span translate="work.capnhatketquacongviec"></span>
                                    </a>&nbsp;&nbsp;or
                                    <input #resultInput hidden="true" type="file" onclick="this.value=null"
                                        (change)="save_file_Direct($event, '11')" />

                                    <a class="action" (click)="resultInput.click()"
                                        matTooltip="{{ 'work.uploadfile' | translate }}">
                                        <span translate="work.themtailieu"></span>
                                        <i class="las la-upload"></i>&nbsp;
                                    </a>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="row align-items-center" style="padding-top: 20px;">
                        <div class="title">
                            <span translate="work.congvieccon"></span>
                        </div>
                        <div class="congvieccon w-100">
                            <div class="sub-task row">
                                <div class="col-md-12">
                                    <mat-form-field class="mat-form-field-fluid ">
                                        <input matInput [(ngModel)]="SubTask" [ngModelOptions]="{standalone: true}"
                                            placeholder="{{ 'work.createsubtask' | translate}}">
                                    </mat-form-field>
                                </div>
                                <div class="col-md-6 m--margin-bottom-10-mobile">
                                    <mat-form-field class="mat-form-field-fluid ">
                                        <input matInput [(ngModel)]="deadline" [ngModelOptions]="{standalone: true}"
                                            [owlDateTime]="dt1" [owlDateTimeTrigger]="dt1"
                                            placeholder="{{ 'work.deadline' | translate}}">
                                        <owl-date-time #dt1></owl-date-time>
                                    </mat-form-field>
                                </div>
                                <div class="col-md-6 m--margin-bottom-10-mobile">
                                    <mat-form-field class="mat-form-field-fluid ">
                                        <input autocomplete="off" matInput placeholder="{{ 'work.giaoviec' | translate }}" id="InputAssign"
                                            type="text" value="{{_Assign}}" [popover]="Assign" [popoverOnHover]="false"
                                            (input)="onSearchChange_Assign($event)" (click)="click_Assign($event)">
                                    </mat-form-field>
                                    <span #hiddenText_Assign
                                        style="visibility:hidden; white-space: pre;font-size:1.1rem; position:absolute">{{_Assign}}</span>
                                    <popover-content #Assign placement="bottom-left" [closeOnClickOutside]="true">
                                        <kt-choose-users [options]="options_assign"
                                            (ItemSelected)="ItemSelected_Assign($event)">
                                        </kt-choose-users>
                                    </popover-content>
                                </div>
                            </div>
                            <ng-container *ngIf="SubTask.length>0">
                                <button type="button" mat-raised-button  class="jee_btn-addcontinue"
                                    matTooltip="{{ 'GeneralKey.luu' | translate }}" (click)="Insert_SubTask()">
                                    <span translate="GeneralKey.themmoi"></span>
                                </button>
                                <button type="button" class="btn text-danger" matTooltip="{{ 'GeneralKey.xoa' | translate }}"
                                    (click)="SubTask=''">
                                    <mat-icon>close</mat-icon>
                                </button>
                            </ng-container>
                        </div>
                        <div class="task-list">
                            <div class="task-list-item" *ngFor="let child of item.Childs">
                                <div class="task-title font-chu">
                                    <mat-checkbox name="UsernameSelectAll" value="-1" >
                                    </mat-checkbox>
                                    <span style="color: #111;">
                                        {{child.title}}
                                    </span>
                                </div>
                                <div class="task-info">
                                    <div style="display: flex; font-size: 11px;float: right;">
                                        <div class="time-line">
                                            {{child.deadline}}
                                        </div>
                                        <div class="assign">
                                            <ng-container *ngIf="child.assign;else noassign">
                                                <img style="width: 25px; height: 25px;border-radius: 50%;"
                                                    src="{{child.assign.image}}" alt="">&nbsp;
                                                <span matTooltip={{child.assign.hoten}}>{{child.assign.hoten}}</span>
                                            </ng-container>
                                            <ng-template #noassign>
                                                <em class="text-muted"> <span translate="GeneralKey.notassigned"></span> </em>
                                            </ng-template>

                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div> 
                    </div>
                </div>
            </ng-container>
        </kt-portlet>
    </div>
    <kt-comment [Id]="item.id_row" [Loai]="1"></kt-comment>
 </form>