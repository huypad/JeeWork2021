<div class="kt-portlet repeat-edit-page" [ngClass]="{ 'kt-portlet--body-progress kt-portlet--body-progress-overlay' : viewLoading }">
    <div class="kt-portlet__head kt-portlet__head__custom">
        <div class="kt-portlet__head-label">
            <h5>{{getTitle()}}</h5>
            
        </div>
    </div>
    <div style="overflow-y: auto; max-height: 70vh; overflow-x: hidden; padding: 0 10px;">
        <form class="kt-form {{(!isUpdatesubtask && !isUpdatetodolist)?'':'d-none'}} " [formGroup]="itemForm">
            <div class=" kt-form__group">
                <div class="row">
                    <div class="col-md-12 kt--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid ">
                            <input matInput placeholder="{{ 'work.tencongviec' | translate }}" class="require" required
                                formControlName="title" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 m--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <mat-select formControlName="frequency" [disabled]="this.item.id_row > 0" class="require"
                                required placeholder="{{ 'repeated.tansuatlaplai' | translate }}"
                                (selectionChange)="Change_frequency($event.value)">
                                <mat-option selected value="1">
                                    <span translate="repeated.hangtuan"></span>
                                </mat-option>
                                <mat-option value="2">
                                    <span translate="repeated.hangthang"></span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row align-items-center">
                    <span style="color: black; font-weight: 500;font-size: 14px; margin-left: 10px; line-height: 30px;"
                        translate="repeated.cacngaylaplai"></span>
                </div>
                <div *ngIf="!show_frequency" class="row align-items-center">
                    <div class="col-lg-6 m--margin-bottom-20-mobile" *ngFor="let day of check_weekdays">
                        <mat-checkbox [checked]="day.Checked" (change)="Checked(day.Code, $event.checked)"
                            value="{{day.Code}}" style="margin-left: 20px"> {{day.Title}}</mat-checkbox>
                    </div>
                </div>
                <div *ngIf="show_frequency" class="row">
                    <div class="col-md-12 kt--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <mat-select multiple formControlName="repeated_day" (selectionChange)="checkDays($event.value)"
                                class="require" required placeholder="{{ 'work.danhsachcacngay' | translate }}">
                                <mat-option *ngFor="let item of dayofmonth" [value]="item">
                                    {{item}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row">
                    
                    <div class="col-md-12 m--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid ">
                            <input matInput placeholder="{{ 'topic.assign' | translate }}" id="InputAssign"
                            autocomplete="off" type="text" value="{{_Assign}}" [popover]="Assign" [popoverOnHover]="false"
                                (input)="onSearchChange_Assign($event)" (click)="click_Assign($event)">
                        </mat-form-field>
                        <span #hiddenText_Assign
                            style="visibility:hidden; white-space: pre;font-size:1.1rem; position:absolute">{{_Assign}}</span>
                        <popover-content #Assign placement="bottom-left" [closeOnClickOutside]="true">
                            <kt-choose-users [options]="options_Assign" (ItemSelected)="ItemSelected_Assign($event)">
                            </kt-choose-users>
                        </popover-content>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 m--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid ">
                            <textarea matInput placeholder="{{ 'topic.nguoitheodoi' | translate }}" id="InputUser" rows="2"
                            value="{{_Follower}}" [popover]="Follower" [popoverOnHover]="false"
                                (input)="onSearchChange($event)" (click)="click($event)"></textarea>
                        </mat-form-field>
                        <span #hiddenText
                            style="visibility:hidden; white-space: pre;font-size:1.1rem; position:absolute">{{_Follower}}</span>
                        <popover-content #Follower placement="bottom-left" [closeOnClickOutside]="true">
                            <kt-choose-users [options]="options" (ItemSelected)="ItemSelected($event)">
                            </kt-choose-users>
                        </popover-content>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 kt--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid ">
                            <input matInput class="require" required placeholder="{{ 'repeated.deadline' | translate }}"
                                formControlName="deadline" />
                        </mat-form-field>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 kt--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <mat-select formControlName="id_project_team" class="require" required [disabled]="id_project>0"
                                (selectionChange)="BindList($event.value)"
                                placeholder="{{ 'topic.projectteam' | translate}}">
                                <mat-option>
                                    <ngx-mat-select-search [formControl]="projectFilterCtrl" [placeholderLabel]="''"
                                        [noEntriesFoundLabel]="''">
                                    </ngx-mat-select-search>
                                </mat-option>
                                <mat-option value="{{user.id_row}}" *ngFor="let user of filtereproject | async">
                                    <span style="color: black;">{{ user.title }}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    
                </div>
                <div class="row">
                    <div class="col-md-12 kt--margin-bottom-10-mobile">
                        <editor apiKey="test" formControlName="description" [init]="tinyMCE"
                            style="margin-bottom: 15px;">
                        </editor>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 m--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <input matInput [matDatepicker]="dp1" type="text" class="require" required
                                [max]="itemForm.value.end_date" placeholder="{{ 'GeneralKey.ngaybatdau' | translate}}"
                                formControlName="start_date">
                            <mat-datepicker-toggle matSuffix [for]="dp1"></mat-datepicker-toggle>
                            <mat-datepicker #dp1></mat-datepicker>
                        </mat-form-field>
                    </div>
                    <div class="col-md-6 m--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <input matInput [matDatepicker]="dp2" type="text" class="require" required
                                [min]="itemForm.value.start_date" placeholder="{{ 'GeneralKey.ngayketthuc' | translate}}"
                                formControlName="end_date">
                            <mat-datepicker-toggle matSuffix [for]="dp2"></mat-datepicker-toggle>
                            <mat-datepicker #dp2></mat-datepicker>
                        </mat-form-field>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12 m--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <mat-select formControlName="Locked" placeholder="{{ 'filter.trangthai' | translate }}">
                                <mat-option [value]="false">
                                    <span translate="filter.kichhoat"></span>
                                </mat-option>
                                <mat-option [value]="true">
                                    <span translate="filter.vohieuhoa"></span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </form>
        <div class="row" style="margin-bottom: 20px;" *ngIf="!showtask">
            <button class="btn btn-success" (click)="showtask=!showtask" style="margin: 0 auto;">
                <span translate="repeated.tuychonnangcao"></span>
            </button>
        </div>
        <div *ngIf="showtask">
            <div class="subtask" [ngStyle]="{'margin-top.px': isUpdatesubtask?'20':'0'}"  *ngIf="(!isUpdatetodolist && !isUpdatesubtask) || isUpdatesubtask">
                <div class="title-subtask">
                    <span translate="repeated.subtasks"></span>
                </div>
                <div class="row header-subtask">
                    <div class="col-md-1 m--margin-bottom-5-mobile center-title">
                        <span translate="GeneralKey.stt"></span>
                    </div>
                    <div class="col-md-4 m--margin-bottom-5-mobile center-title">
                        <span translate="repeated.subtasks"></span>
                    </div>
                    <div class="col-md-4 m--margin-bottom-5-mobile center-title">
                        <span translate="repeated.assign"></span>
                    </div>
                    <div class="col-md-3 m--margin-bottom-5-mobile center-title">
                        <span translate="repeated.deadline_hour"></span>
                    </div>
                </div>
                <div class="row body-subtask bg-white" *ngFor="let list of listColumn; let i = index"
                    style="border-bottom: 0.5px solid rgb(222, 222, 222);">
                    <div class="col-md-1 m--margin-bottom-5-mobile"
                        style="justify-content: center; display: flex;font-size: 11pt; padding-top: 20px;border-right: 1px solid #eeee;">
                        {{i + 1}}
                    </div>
                    <div class="col-md-4 kt--margin-bottom-10-mobile" style="border-right: 1px solid #eeee;">
                        <mat-form-field class="mat-form-field-fluid">
                            <input matInput placeholder="{{ 'repeated.subtasks' | translate}} #{{i+1}}"
                                (focusout)="checkShow($event,listColumn)" [(ngModel)]="listColumn[i].SubTask">
                        </mat-form-field>
                    </div>
                    <div class="col-md-4 kt--margin-bottom-10-mobile" style="border-right: 1px solid #eeee;">
                        <mat-form-field class="mat-form-field-fluid">
                            <mat-select [(ngModel)]="listColumn[i].id_nv">
                                
                                <mat-option value="">
                                    <span class="text-muted"> -- {{ 'workprocess.giaocho' | translate }} --</span>
                                </mat-option>
                                <mat-option [value]="user.id_nv" *ngFor="let user of filter_member | async">
                                    <span style="color: black;">{{ user.hoten }}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                    <div class="col-md-3 kt--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <input matInput placeholder="{{ 'repeated.deadline_hour' | translate}}"
                                [(ngModel)]="listColumn[i].Deadline">
                        </mat-form-field>
                    </div>
                </div>
            </div>
            <div class="subtask" [ngStyle]="{'margin-top.px': isUpdatetodolist?'20':'0'}" *ngIf="(!isUpdatetodolist && !isUpdatesubtask) || isUpdatetodolist">
                <div class="title-subtask">
                        <span translate="repeated.checklist"></span>
                </div>
                <div class="row header-subtask ">
                    <div class="col-md-1 m--margin-bottom-5-mobile center-title">
                        <span translate="GeneralKey.stt"></span>
                    </div>
                    <div class="col-md-6 m--margin-bottom-5-mobile center-title">
                        <span translate="repeated.subtasks"></span>
                    </div>
                    <div class="col-md-5 m--margin-bottom-5-mobile center-title">
                        <span translate="repeated.assign"></span>
                    </div>
                </div>
                <div class="row body-subtask bg-white" *ngFor="let list of listCol_Todo; let i = index"
                    style="border-bottom: 0.5px solid rgb(222, 222, 222);">
                    <div class="col-md-1 m--margin-bottom-5-mobile"
                        style="justify-content: center; display: flex;font-size: 11pt; padding-top: 20px;border-right: 1px solid #eeee;">
                        {{i + 1}}
                    </div>
                    <div class="col-md-6 kt--margin-bottom-10-mobile" style="border-right: 1px solid #eeee;">
                        <mat-form-field class="mat-form-field-fluid">
                            <input matInput placeholder="{{ 'repeated.todos' | translate}} #{{i+1}}"
                                (focusout)="checkShow_Todo($event,listCol_Todo)" [(ngModel)]="listCol_Todo[i].todo">
                        </mat-form-field>
                    </div>
                    <div class="col-md-5 kt--margin-bottom-10-mobile">
                        <mat-form-field class="mat-form-field-fluid">
                            <mat-select [(ngModel)]="listCol_Todo[i].id_nv">
                                <mat-option value="">
                                    <span class="text-muted"> -- {{ 'workprocess.giaocho' | translate }} --</span>
                                </mat-option>
                                <mat-option [value]="user.id_nv" *ngFor="let user of filter_member_todo | async">
                                    <span style="color: black;">{{ user.hoten }}</span>
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="kt-portlet__foot">
        <div class="kt-form__actions kt-form__actions--solid">
            <div class="row text-right">
                <div class="col-lg-12">
                    <button type="button" class="mat-raised-button" (click)="close()" [disabled]="disabledBtn"
                        cdkFocusInitial matTooltip="{{ 'GeneralKey.trolai' | translate }}">
                        <span translate="GeneralKey.trolai"></span>&nbsp;&nbsp;<div *ngIf="disabledBtn"
                            class="spinner-button-pad"></div>
                    </button>&nbsp;
                    <button type="button" mat-raised-button class="jee_btn-addcontinue" (click)="onSubmit(true)"
                        [disabled]="disabledBtn" matTooltip="{{ 'GeneralKey.luudong' | translate }}">
                        <span translate="GeneralKey.luudong"></span>&nbsp;&nbsp;<div *ngIf="disabledBtn"
                            class="spinner-button-pad"></div>
                    </button> &nbsp;
                </div>
            </div>
        </div>
    </div>
</div>